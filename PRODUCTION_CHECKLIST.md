# 🚀 本番化・公開前チェックリスト

## 📋 概要
このドキュメントは、ステップナビアプリを本番環境に公開する前に確認すべき項目をまとめたものです。

**最終更新**: 2025年1月27日

---

## 🔴 必須対応項目（公開前に必ず実施）

### 1. セキュリティ

#### 1.1 開発用コードの削除・無効化
- [ ] **開発用「Unlock All」ボタンの削除**
  - 場所: `index.html` の `#devPurchaseSection` (1176-1221行目)
  - 対応: 本番環境では非表示になっているが、より確実にするため完全に削除することを推奨
  - 現在の状態: 開発環境判定（localhost/127.0.0.1）で非表示になっている
  - ⚠️ **重要**: 本番環境のURLが正しく判定されることを確認

- [ ] **開発用関数の削除または条件分岐の確認**
  - `app.js` の `unlockAll()` 関数（5665行目付近）
  - 開発環境判定が正しく機能しているか確認
  - 本番環境では実行されないことを確認

#### 1.2 環境変数の確認
- [ ] **Netlify環境変数の設定確認**
  - `STRIPE_SECRET_KEY`: Stripe本番キーが設定されているか
  - `STRIPE_WEBHOOK_SECRET`: Stripe Webhookシークレットが設定されているか
  - `FIREBASE_SERVICE_ACCOUNT`: Firebase Admin SDKのサービスアカウントJSON
  - `URL`: 本番環境のURLが設定されているか

- [ ] **Firebase設定の確認**
  - `firebaseconfig.js` のAPIキーが本番用か確認
  - Firebase Authenticationの認証ドメインが正しく設定されているか
  - Firestoreのセキュリティルールが適切に設定されているか

#### 1.3 CORS設定の確認
- [ ] **Netlify FunctionsのCORS設定**
  - `create-checkout-session.js` の `Access-Control-Allow-Origin` が適切か
  - 本番環境では `*` ではなく、特定のドメインを指定することを推奨

### 2. デバッグコードの削除

#### 2.1 console.log の削除または最小化
- [ ] **console.log の整理**
  - 現在: **503箇所**の `console.log` が存在（`app.js`）
  - 対応: 本番環境では不要なログを削除、または本番環境判定で無効化
  - 推奨: エラーログ（`console.error`）のみ残す
  - 実装案: 本番環境判定関数を作成し、開発環境でのみログを出力

#### 2.2 デバッグ関数の無効化
- [ ] **デバッグ関数の確認**
  - `showReviewSystemDebugInfo()` 関数
  - `debugCurrentState()` 関数
  - 本番環境ではアクセスできないようにする

### 3. エラーハンドリングの強化

#### 3.1 ユーザーフレンドリーなエラーメッセージ
- [ ] **エラーメッセージの確認**
  - 技術的なエラーメッセージがユーザーに表示されていないか
  - すべてのエラーが適切な日本語メッセージに変換されているか

#### 3.2 ネットワークエラーの処理
- [ ] **オフライン時の動作確認**
  - Service Workerが正しく動作しているか
  - オフラインページが表示されるか
  - エラーメッセージが適切か

### 4. SEO・メタデータ

#### 4.1 基本メタタグ
- [x] **title**: 設定済み
- [x] **description**: 設定済み
- [ ] **OGP（Open Graph Protocol）タグの追加**
  - `og:title`, `og:description`, `og:image`, `og:url` など
  - SNSシェア時の表示を改善
  - 現在の状態: **未実装** - 追加が必要

- [ ] **Twitter Card タグの追加**
  - `twitter:card`, `twitter:title`, `twitter:description`, `twitter:image` など
  - 現在の状態: **未実装** - 追加が必要

#### 4.2 robots.txt の作成
- [ ] **robots.txt ファイルの作成**
  - 検索エンジンのクロール設定
  - 本番環境のURLを指定

#### 4.3 sitemap.xml の作成
- [ ] **sitemap.xml ファイルの作成**
  - 主要なページのURLをリストアップ
  - 更新頻度と優先度を設定

### 5. パフォーマンス最適化

#### 5.1 画像の最適化
- [ ] **画像の圧縮確認**
  - すべての画像が適切に圧縮されているか
  - WebP形式への変換を検討

#### 5.2 リソースの読み込み
- [ ] **遅延読み込みの実装**
  - 画像の `loading="lazy"` 属性
  - 非同期スクリプトの読み込み

#### 5.3 Service Worker の最適化
- [ ] **キャッシュ戦略の確認**
  - `sw.js` のキャッシュ設定が適切か
  - キャッシュバージョンが正しく更新されるか

### 6. アクセシビリティ

#### 6.1 ARIA属性の確認
- [x] **基本的なARIA属性**: 実装済み
- [ ] **より詳細なARIA属性の追加**
  - 複雑なUIコンポーネントへの `aria-describedby`
  - フォームの `aria-required` 属性

#### 6.2 キーボード操作
- [x] **基本的なキーボード操作**: 実装済み
- [ ] **フォーカス管理の最終確認**
  - モーダル内のフォーカストラップ
  - スキップリンクの動作確認

### 7. 本番環境の設定

#### 7.1 Netlify設定
- [x] **netlify.toml**: 設定済み
- [ ] **環境変数の設定確認**
  - Netlifyダッシュボードで環境変数が正しく設定されているか
  - 本番環境とステージング環境の変数が分離されているか

#### 7.2 Stripe設定
- [ ] **Stripe本番環境の確認**
  - 本番環境のAPIキーが使用されているか
  - Webhookエンドポイントが正しく設定されているか
  - テストモードから本番モードへの切り替え確認

#### 7.3 Firebase設定
- [ ] **Firebase本番環境の確認**
  - Firestoreのセキュリティルールが適切か
  - Authenticationの設定が正しいか
  - ストレージの設定（使用している場合）

### 8. テスト

#### 8.1 機能テスト
- [ ] **主要機能の動作確認**
  - ログイン・ログアウト
  - レッスンの開始・完了
  - 進捗の保存・読み込み
  - 購入フロー（テストモードで確認）

#### 8.2 ブラウザ互換性
- [ ] **主要ブラウザでの動作確認**
  - Chrome（最新版）
  - Safari（最新版）
  - Firefox（最新版）
  - Edge（最新版）
  - モバイルブラウザ（iOS Safari、Chrome Mobile）

#### 8.3 レスポンシブデザイン
- [ ] **各種デバイスでの表示確認**
  - スマートフォン（iPhone、Android）
  - タブレット（iPad、Android Tablet）
  - デスクトップ（各種解像度）

### 9. 法的・コンプライアンス

#### 9.1 プライバシーポリシー
- [ ] **プライバシーポリシーページの作成**
  - 個人情報の取り扱い
  - データの保存・利用目的
  - 第三者サービス（Firebase、Stripe）の使用について

#### 9.2 利用規約
- [ ] **利用規約ページの作成**
  - サービスの利用条件
  - 禁止事項
  - 免責事項

#### 9.3 特定商取引法に基づく表示
- [ ] **特定商取引法ページの作成**
  - 事業者情報
  - 販売価格
  - 支払い方法
  - 返品・キャンセルポリシー

### 10. 監視・ログ

#### 10.1 エラー監視
- [ ] **エラー監視ツールの導入検討**
  - Sentry、LogRocket などのエラー監視サービス
  - 本番環境でのエラーを自動検知

#### 10.2 アナリティクス
- [ ] **アクセス解析の設定**
  - Google Analytics の導入
  - ユーザー行動の追跡（プライバシーに配慮）

---

## 🟡 推奨対応項目（可能な限り実施）

### 1. パフォーマンス

#### 1.1 コードの最適化
- [ ] **JavaScript の minify**
  - 本番環境では minify されたコードを配信
  - Netlify のビルド設定で自動化

#### 1.2 リソースの最適化
- [ ] **CSS の minify**
- [ ] **HTML の minify**
- [ ] **画像の最適化**（WebP形式への変換）

### 2. セキュリティ

#### 2.1 HTTPS の強制
- [x] **Netlify で自動的に HTTPS が有効**: 確認済み
- [ ] **HSTS ヘッダーの設定**
  - `_headers` ファイルに追加

#### 2.2 Content Security Policy (CSP)
- [ ] **CSP ヘッダーの最適化**
  - `_headers` ファイルの CSP 設定を確認
  - 不要な `unsafe-inline` や `unsafe-eval` を削除

### 3. ユーザー体験

#### 3.1 ローディング状態
- [ ] **ローディングインジケーターの改善**
  - すべての非同期処理にローディング表示

#### 3.2 エラーメッセージ
- [ ] **エラーメッセージの改善**
  - より具体的で分かりやすいメッセージ
  - 解決方法の提示

### 4. ドキュメント

#### 4.1 運用マニュアル
- [ ] **運用マニュアルの作成**
  - デプロイ手順
  - 環境変数の設定方法
  - トラブルシューティング

#### 4.2 API ドキュメント
- [ ] **API ドキュメントの作成**（必要に応じて）
  - Netlify Functions の仕様
  - データ構造の説明

---

## 🟢 完了済み項目

### 実装済み
- [x] PWA対応（manifest.json、Service Worker）
- [x] レスポンシブデザイン
- [x] 基本的なアクセシビリティ対応（ARIA属性）
- [x] エラーハンドリングの基本実装
- [x] オフライン対応（Service Worker）
- [x] 連続学習記録システム
- [x] 学習統計機能
- [x] 背景テーマシステム
- [x] データのエクスポート・インポート機能
- [x] ヘルプ機能

---

## 📝 注意事項

### 開発環境と本番環境の違い
- 開発環境（localhost/127.0.0.1）では開発用機能が有効
- 本番環境では開発用機能が自動的に無効化される
- ただし、明示的に削除または無効化することを推奨

### データの移行
- 本番環境への移行時、既存のユーザーデータの移行計画を立てる
- テストデータと本番データの分離

### ロールバック計画
- 問題発生時のロールバック手順を準備
- バージョン管理の確認

---

## 🔍 最終確認項目

公開前に以下を必ず確認：

1. [ ] すべての必須対応項目が完了している
2. [ ] 本番環境で動作確認が完了している
3. [ ] セキュリティチェックが完了している
4. [ ] 法的文書（プライバシーポリシー、利用規約）が準備されている
5. [ ] エラー監視・ログ設定が完了している
6. [ ] バックアップ・復旧計画が準備されている

---

## 📞 問い合わせ先

問題や質問がある場合は、開発チームに問い合わせてください。

---

**最終確認日**: ___________  
**確認者**: ___________  
**承認者**: ___________

