<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å­¦ã¶ç†ç§‘ - å¤©æ°—ã®å¤‰åŒ–ï¼ˆä½æ°—åœ§ã¨å‰ç·šï¼‰</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: "Hiragino Sans", "Yu Gothic", sans-serif;
      background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 40%, #fffde7 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: rgba(255,255,255,0.95);
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .home-btn {
      background:#42a5f5;
      color:white;
      border:none;
      padding:8px 14px;
      border-radius:20px;
      font-size:13px;
      cursor:pointer;
      transition:all 0.3s ease;
      min-height:44px;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }
    .home-btn:hover { background:#1e88e5; transform:translateY(-1px); }
    .home-btn:active { transform:scale(0.98); }
    .lesson-title {
      font-size:14px;
      font-weight:bold;
      color:#333;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      flex:1;
      margin:0 8px;
    }
    .main-container {
      flex:1;
      display:flex;
      flex-direction:column;
      padding:10px;
    }

    /* â–¼ ã‚·ãƒŸãƒ¥å…¨ä½“ */
    .sim-container {
      background:white;
      border-radius:15px;
      box-shadow:0 8px 25px rgba(0,0,0,0.15);
      margin-bottom:15px;
      overflow:hidden;
      position:relative;
    }
    .sim-header {
      background:linear-gradient(135deg, #42a5f5 0%, #66bb6a 100%);
      color:white;
      padding:8px 10px;
      text-align:center;
    }
    .sim-header h2 { font-size:14px; margin-bottom:0; line-height:1.4; }
    .sim-header p { display:none; }

    .sim-area {
      padding:8px;
      background:#e3f2fd;
    }

    .control-row {
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:8px;
    }
    .control-label {
      font-size:13px;
      font-weight:bold;
      color:#1a237e;
      width:100%;
    }
    .time-slider-wrap {
      width:100%;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .time-slider {
      width:100%;
      -webkit-appearance:none;
      height:8px;
      border-radius:999px;
      background:#c5cae9;
      outline:none;
    }
    .time-slider::-webkit-slider-thumb {
      -webkit-appearance:none;
      appearance:none;
      width:28px;
      height:28px;
      border-radius:50%;
      background:radial-gradient(circle,#64b5f6 0%,#42a5f5 45%,#1e88e5 100%);
      box-shadow:0 2px 6px rgba(66,165,245,0.4);
      cursor:pointer;
      border:2px solid white;
      margin-top:-10px;
    }
    .time-slider::-moz-range-thumb {
      width:28px;
      height:28px;
      border-radius:50%;
      background:#42a5f5;
      border:2px solid white;
      cursor:pointer;
    }
    .time-steps {
      display:flex;
      justify-content:space-between;
      font-size:10px;
      color:#555;
      line-height:1.3;
    }
    .mode-desc {
      display:none;
    }

    /* â–¼ å¤©æ°—å›³ã‚·ãƒ¼ãƒ³ */
    .sim-field {
      position:relative;
      margin-top:6px;
      border-radius:12px;
      padding:8px;
      overflow:hidden;
      min-height:200px;
      background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(240,248,255,0.9));
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }

    .map-scene {
      position:relative;
      width:100%;
      height:180px;
      border-radius:12px;
      overflow:hidden;
      background:
        radial-gradient(circle at 10% 0%, rgba(66,165,245,0.15), transparent 55%),
        radial-gradient(circle at 95% 15%, rgba(102,187,106,0.12), transparent 55%),
        linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 50%, #fffde7 100%);
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      border:1px solid rgba(66,165,245,0.3);
      transition:background 0.4s ease;
    }

    /* ç­‰åœ§ç·š */
    .isobar {
      position:absolute;
      width:140%;
      height:140%;
      border-radius:50%;
      border:1px solid rgba(148,163,184,0.5);
      opacity:0.7;
      animation:spinIsobar 40s linear infinite;
    }
    .isobar:nth-child(1) { top:-25%; left:-10%; }
    .isobar:nth-child(2) { top:-10%; left:-15%; transform:scale(0.8); animation-duration:52s; }
    .isobar:nth-child(3) { top:-15%; left:-5%; transform:scale(1.2); animation-duration:65s; }

    @keyframes spinIsobar {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg); }
    }

    /* æ—¥æœ¬ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼ˆã–ã£ãã‚Šï¼‰ */
    .japan-shape {
      position:absolute;
      right:18%;
      top:22%;
      width:23%;
      height:48%;
      background:linear-gradient(135deg, rgba(148,163,184,0.9), rgba(241,245,249,0.95));
      clip-path:polygon(
        50% 0%,
        70% 12%, 75% 25%, 80% 38%,
        72% 52%, 60% 60%, 58% 75%,
        55% 100%, 45% 80%, 40% 60%,
        30% 42%, 32% 25%, 40% 10%
      );
      box-shadow:0 0 14px rgba(248,250,252,0.8);
      opacity:0.92;
    }

    /* ä½æ°—åœ§ L ãƒãƒ¼ã‚¯ */
    .low-center {
      position:absolute;
      font-size:28px;
      font-weight:bold;
      color:#f97316;
      text-shadow:
        0 0 6px rgba(251,146,60,0.9),
        0 0 14px rgba(248,250,252,0.8);
      transition:transform 0.4s ease;
    }

    /* å‰ç·šãƒ©ã‚¤ãƒ³ */
    .front-line {
      position:absolute;
      height:4px;
      border-radius:999px;
      background:linear-gradient(90deg,#ef4444 0%,#3b82f6 100%);
      box-shadow:0 0 10px rgba(239,68,68,0.8);
      transform-origin:left center;
      transition:transform 0.4s ease, opacity 0.4s ease;
    }
    .front-marks {
      position:absolute;
      height:0;
      width:100%;
      top:-6px;
      left:0;
      pointer-events:none;
    }
    .front-marks::before,
    .front-marks::after {
      content:"";
      position:absolute;
      border-radius:999px;
      border-top:6px solid transparent;
      border-bottom:6px solid transparent;
    }
    .front-marks::before {
      border-left:10px solid #ef4444;
      top:6px; left:12px;
      box-shadow:0 0 8px rgba(248,113,113,0.9);
    }
    .front-marks::after {
      border-radius:50%;
      width:10px; height:10px;
      border:3px solid #3b82f6;
      top:-4px; left:40px;
      box-shadow:0 0 8px rgba(59,130,246,0.9);
    }

    /* é›² */
    .cloud {
      position:absolute;
      width:70px;
      height:40px;
      background:radial-gradient(circle at 30% 30%, #f9fafb 0%, #e5e7eb 40%, #cbd5f5 100%);
      border-radius:999px;
      box-shadow:0 8px 18px rgba(15,23,42,0.8);
      opacity:0.9;
      filter:drop-shadow(0 4px 6px rgba(15,23,42,0.9));
      animation:cloudFloat 12s ease-in-out infinite;
    }
    .cloud::before,
    .cloud::after {
      content:"";
      position:absolute;
      background:inherit;
      border-radius:999px;
    }
    .cloud::before {
      width:45px; height:30px;
      left:-10px; top:4px;
    }
    .cloud::after {
      width:50px; height:32px;
      right:-8px; top:6px;
    }
    .cloud.c2 { animation-duration:15s; transform:scale(0.9); opacity:0.85; }
    .cloud.c3 { animation-duration:18s; transform:scale(0.8); opacity:0.8; }

    @keyframes cloudFloat {
      0%,100% { transform:translateX(0); }
      50% { transform:translateX(10px); }
    }

    /* é›¨ */
    .rain {
      position:absolute;
      width:120px;
      height:80px;
      pointer-events:none;
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .rain-line {
      position:absolute;
      width:1px;
      height:12px;
      background:linear-gradient(180deg,#38bdf8,#0ea5e9);
      border-radius:999px;
      opacity:0.9;
      animation:rainDrop 0.5s linear infinite;
    }
    .rain-line:nth-child(2){ left:20%; animation-delay:0.1s;}
    .rain-line:nth-child(3){ left:35%; animation-delay:0.15s;}
    .rain-line:nth-child(4){ left:50%; animation-delay:0.05s;}
    .rain-line:nth-child(5){ left:65%; animation-delay:0.08s;}
    .rain-line:nth-child(6){ left:80%; animation-delay:0.12s;}

    @keyframes rainDrop {
      0% { transform:translateY(-5px); opacity:0.9;}
      100% { transform:translateY(18px); opacity:0;}
    }

    .map-scene.rain-light .rain { opacity:0.4; }
    .map-scene.rain-strong .rain { opacity:0.9; }

    /* é¢¨å‘ãçŸ¢å° */
    .wind-arrow {
      position:absolute;
      bottom:12%;
      left:10%;
      width:80px;
      height:4px;
      border-radius:999px;
      background:linear-gradient(90deg,#e5e7eb,#38bdf8);
      box-shadow:0 0 10px rgba(56,189,248,0.7);
      transform-origin:10% 50%;
      transition:transform 0.4s ease;
    }
    .wind-arrow::after {
      content:"";
      position:absolute;
      right:-4px;
      top:-4px;
      border-left:10px solid #38bdf8;
      border-top:6px solid transparent;
      border-bottom:6px solid transparent;
      filter:drop-shadow(0 0 6px rgba(56,189,248,0.9));
    }

    .sky-label {
      position:absolute;
      bottom:8px;
      right:8px;
      left:8px;
      padding:8px 10px;
      font-size:11px;
      border-radius:8px;
      background:rgba(255,255,255,0.95);
      color:#333;
      display:flex;
      align-items:center;
      gap:6px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
      border:1px solid rgba(66,165,245,0.3);
    }
    .sky-label span.icon {
      font-size:14px;
      filter:drop-shadow(0 1px 2px rgba(0,0,0,0.2));
      flex-shrink:0;
    }
    .sky-label span:last-child {
      flex:1;
      line-height:1.4;
    }

    .sky-tag {
      position:absolute;
      top:8px;
      left:8px;
      padding:6px 10px;
      font-size:10px;
      border-radius:8px;
      background:rgba(255,255,255,0.95);
      color:#1976d2;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
      border:1px solid rgba(66,165,245,0.3);
      font-weight:bold;
    }

    /* infoã‚«ãƒ¼ãƒ‰ï¼ˆã‹ãªã‚Šãƒ†ã‚­ã‚¹ãƒˆå°‘ãªã‚ï¼‰ */
    .env-panel {
      display:none;
    }
    .env-card {
      width:100%;
      background:linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
      border-radius:12px;
      padding:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.5);
      transition:transform 0.3s ease, box-shadow 0.3s ease;
    }
    .env-card:hover {
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.7);
    }
    .env-title {
      font-size:13px;
      font-weight:bold;
      margin-bottom:4px;
      color:#1a237e;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .env-title span.emoji {
      font-size:16px;
      filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      animation:float 3s ease-in-out infinite;
    }
    @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-3px);} }
    .env-value {
      font-size:14px;
      font-weight:bold;
      margin-bottom:2px;
      color:#1976d2;
    }
    .env-sub {
      font-size:12px;
      color:#555;
      line-height:1.4;
    }

    .sim-comment {
      display:none;
    }

    /* â–¼ infoãƒ‘ãƒãƒ«ï¼ˆçŸ­æ–‡ï¼‰ */
    .info-panel {
      display:none;
    }
    .info-panel h3 {
      color:#333;
      margin-bottom:12px;
      font-size:16px;
      line-height:1.4;
    }
    .info-grid {
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    .info-item {
      background:#f8f9fa;
      padding:12px;
      border-radius:10px;
      border-left:4px solid #64b5f6;
    }
    .info-item h4 {
      color:#1976d2;
      margin-bottom:6px;
      font-size:14px;
    }
    .info-item p {
      color:#555;
      font-size:13px;
      line-height:1.5;
    }

    /* â–¼ å•é¡Œãƒ‘ãƒãƒ« */
    .question-container {
      background:white;
      border-radius:15px;
      box-shadow:0 8px 25px rgba(0,0,0,0.15);
      padding:14px;
      margin-bottom:12px;
    }
    .question-text {
      font-size:15px;
      font-weight:bold;
      color:#333;
      margin-bottom:12px;
      line-height:1.5;
    }
    .progress-bar {
      background:#e9ecef;
      border-radius:999px;
      height:8px;
      margin:10px 0 14px;
      overflow:hidden;
    }
    .progress-fill {
      background:linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
      height:100%;
      width:0%;
      transition:width 0.3s ease;
    }
    .choices {
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .choice {
      padding:14px 16px;
      background:#f8f9fa;
      border:2px solid #e9ecef;
      border-radius:10px;
      cursor:pointer;
      transition:all 0.3s ease;
      font-size:14px;
      min-height:52px;
      display:flex;
      align-items:center;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      color:#333;
      line-height:1.5;
    }
    .choice:hover {
      background:#e9ecef;
      border-color:#64b5f6;
    }
    .choice.correct {
      background:#28a745;
      color:white;
      border-color:#28a745;
      animation:correctPulse 0.6s ease;
    }
    .choice.incorrect {
      background:#dc3545;
      color:white;
      border-color:#dc3545;
      animation:wrongShake 0.6s ease;
    }
    @keyframes correctPulse {
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.04);}
    }
    @keyframes wrongShake {
      0%,100%{transform:translateX(0);}
      25%{transform:translateX(-8px);}
      75%{transform:translateX(8px);}
    }

    .explanation {
      margin-top:15px;
      padding:15px;
      background:#f8f9fa;
      border-radius:10px;
      border-left:4px solid #28a745;
      display:none;
    }
    .explanation.show { display:block; }
    .explanation h4 {
      color:#28a745;
      margin-bottom:8px;
      font-size:14px;
    }
    .explanation p {
      color:#555;
      line-height:1.5;
      font-size:13px;
    }

    .navigation {
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:14px;
    }
    .nav-btn {
      padding:14px 18px;
      border:none;
      border-radius:999px;
      font-size:14px;
      font-weight:bold;
      cursor:pointer;
      transition:all 0.3s ease;
      min-height:48px;
      width:100%;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }
    .nav-btn:disabled {
      opacity:0.4;
      cursor:not-allowed;
    }
    .prev-btn {
      background:#6c757d;
      color:white;
    }
    .prev-btn:hover:not(:disabled) { background:#5a6268; }
    .next-btn {
      background:#42a5f5;
      color:white;
    }
    .next-btn:hover:not(:disabled) { background:#1e88e5; }

    * { touch-action:manipulation; }
    .choice, .nav-btn, .home-btn {
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }

    /* 375pxä»¥ä¸Šã§æ®µéšçš„ã«æ‹¡å¤§ */
    @media (min-width:480px){
      .header { padding:10px 15px; }
      .home-btn { padding:10px 18px; font-size:14px; }
      .lesson-title { font-size:16px; margin:0 10px; }
      .main-container { padding:12px; }
      .sim-header { padding:12px; }
      .sim-header h2 { font-size:16px; }
      .sim-header p { display:block; font-size:12px; }
      .sim-area { padding:10px; }
      .control-row { flex-direction:row; align-items:center; }
      .control-label { width:auto; min-width:100px; }
      .time-slider-wrap { flex:1; }
      .mode-desc { display:block; width:auto; min-width:120px; text-align:right; font-size:11px; }
      .sim-field { padding:10px; min-height:220px; }
      .map-scene { height:180px; }
      .sky-label { bottom:10px; right:10px; left:auto; width:auto; }
      .env-panel { display:flex; flex-direction:row; flex-wrap:wrap; }
      .env-card { flex:1 1 140px; }
      .sim-comment { display:block; }
      .info-panel { display:block; padding:16px; }
      .info-grid { grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px; }
      .info-item { padding:14px; }
      .question-container { padding:16px; }
      .question-text { font-size:16px; }
      .navigation { flex-direction:row; }
      .nav-btn { width:auto; flex:1; }
    }
    @media (min-width:768px){
      .main-container { padding:15px; }
      .sim-header h2 { font-size:20px; }
      .sim-header p { font-size:14px; }
      .sim-field { min-height:260px; }
      .map-scene { height:190px; }
      .info-panel { padding:20px; }
      .info-grid { grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:15px; }
      .info-item { padding:15px; }
      .question-container { padding:20px; }
      .question-text { font-size:16px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <button class="home-btn" onclick="goHome()">ğŸ  ãƒ›ãƒ¼ãƒ </button>
    <div class="lesson-title">å¤©æ°—ã®å¤‰åŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä½æ°—åœ§ã¨å‰ç·šï¼‰</div>
    <div style="width:80px;"></div>
  </header>

  <main class="main-container">
    <!-- â–¼ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <section class="sim-container">
      <div class="sim-header">
        <h2>ä½æ°—åœ§ãŒé€šã‚‹ã¨ãã® å¤©æ°—ã¨é¢¨ã®å¤‰åŒ–</h2>
        <p>ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ™‚é–“ã‚’å‹•ã‹ã—ã¦ã€é›²ãƒ»é›¨ãƒ»é¢¨å‘ãã®å¤‰åŒ–ã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚</p>
      </div>

      <div class="sim-area">
        <div class="control-row">
          <div class="control-label">æ™‚é–“ã®æµã‚Œ</div>
          <div class="time-slider-wrap">
            <input type="range" min="0" max="3" step="1" value="0" class="time-slider" id="timeSlider" />
            <div class="time-steps">
              <span>â‘  é ãã«ã‚ã‚‹</span>
              <span>â‘¡ è¿‘ã¥ã</span>
              <span>â‘¢ çœŸä¸Šã‚’é€šã‚‹</span>
              <span>â‘£ æ±ã¸å»ã‚‹</span>
            </div>
          </div>
          <div class="mode-desc" id="timeDesc">ã¾ã é›¢ã‚Œã¦ã„ã¦ã€å¤©æ°—ã¯ã¾ãšã¾ãš</div>
        </div>

        <div class="sim-field">
          <div class="map-scene" id="mapScene">
            <!-- ç­‰åœ§ç·š -->
            <div class="isobar"></div>
            <div class="isobar"></div>
            <div class="isobar"></div>

            <!-- æ—¥æœ¬ã®ã–ã£ãã‚Šã‚·ãƒ«ã‚¨ãƒƒãƒˆ -->
            <div class="japan-shape"></div>

            <!-- ä½æ°—åœ§ L ãƒãƒ¼ã‚¯ -->
            <div class="low-center" id="lowCenter">L</div>

            <!-- å‰ç·š -->
            <div class="front-line" id="frontLine">
              <div class="front-marks"></div>
            </div>

            <!-- é›² -->
            <div class="cloud c1" id="cloud1"></div>
            <div class="cloud c2" id="cloud2"></div>
            <div class="cloud c3" id="cloud3"></div>

            <!-- é›¨ã‚¨ãƒªã‚¢ -->
            <div class="rain" id="rainArea">
              <div class="rain-line" style="left:10%; top:5%;"></div>
              <div class="rain-line" style="left:25%; top:15%;"></div>
              <div class="rain-line" style="left:40%; top:8%;"></div>
              <div class="rain-line" style="left:55%; top:18%;"></div>
              <div class="rain-line" style="left:70%; top:6%;"></div>
              <div class="rain-line" style="left:85%; top:12%;"></div>
            </div>

            <!-- é¢¨å‘ãçŸ¢å° -->
            <div class="wind-arrow" id="windArrow"></div>

            <!-- ãƒ©ãƒ™ãƒ« -->
            <div class="sky-tag" id="skyTag">ä½æ°—åœ§ï¼šã¾ã é ã„</div>
            <div class="sky-label">
              <span class="icon" id="skyIcon">ğŸŒ¤</span>
              <span id="skyLabelText">é›²ã¯å°‘ãªã‚ãƒ»é›¨ã¯ã¾ã é™ã‚‰ãªã„</span>
            </div>
          </div>

          <div class="env-panel">
            <div class="env-card">
              <div class="env-title"><span class="emoji">â˜ï¸</span>é›²ã®ã‚ˆã†ã™</div>
              <div class="env-value" id="cloudText">å°‘ãªã‚</div>
              <div class="env-sub">å‰ç·šãŒè¿‘ã¥ãã»ã©ã€ã ã‚“ã ã‚“ãµãˆã‚‹</div>
            </div>
            <div class="env-card">
              <div class="env-title"><span class="emoji">ğŸŒ§</span>é›¨ã®å¼·ã•</div>
              <div class="env-value" id="rainText">ãªã—</div>
              <div class="env-sub">é€šéã®å‰å¾Œã§ã€é›¨ãŒå¼·ã¾ã‚‹æ™‚é–“ãŒã‚ã‚‹</div>
            </div>
            <div class="env-card">
              <div class="env-title"><span class="emoji">ğŸ’¨</span>é¢¨ã®å‘ã</div>
              <div class="env-value" id="windText">å¼±ã„é¢¨</div>
              <div class="env-sub">é€šéå‰ã¯å—ã‚ˆã‚Šã€é€šéå¾Œã¯åŒ—ã‚ˆã‚Šã®é¢¨ã«ãªã‚Šã‚„ã™ã„</div>
            </div>
          </div>

          <div class="sim-comment" id="simComment">
            <strong>â‘  ä½æ°—åœ§ãŒã¾ã é ã„ã¨ã</strong>ã¯ã€é›²ã¯å°‘ãªã‚ã§ã€é›¨ã‚‚ã»ã¨ã‚“ã©é™ã‚Šã¾ã›ã‚“ã€‚é¢¨ã‚‚å¼±ã„ã“ã¨ãŒå¤šã„ã§ã™ã€‚
          </div>
        </div>
      </div>
    </section>

    <!-- â–¼ å°å…¥ãƒ†ã‚­ã‚¹ãƒˆï¼ˆçŸ­ãï¼‰ -->
    <section class="info-panel">
      <h3>ä½æ°—åœ§ãŒé€šã‚‹ã¨ãã®åŸºæœ¬</h3>
      <div class="info-grid">
        <div class="info-item">
          <h4>â‘  è¿‘ã¥ãï¼šé›²ãŒãµãˆã€é›¨ãƒ»é¢¨ãŒå¼·ã¾ã‚‹</h4>
          <p>ä½æ°—åœ§ã‚„å‰ç·šãŒè¿‘ã¥ãã¨ã€ç©ºã«ã¯<strong>é›²ãŒãµãˆ</strong>ã€ã—ã ã„ã«<strong>é›¨ã‚„é¢¨ãŒå¼·ã¾ã‚‹</strong>ã“ã¨ãŒå¤šã„ã€‚</p>
        </div>
        <div class="info-item">
          <h4>â‘¡ é€šéä¸­ï¼šé›¨ãƒ»é¢¨ã®ãƒ”ãƒ¼ã‚¯</h4>
          <p>ä½æ°—åœ§ãŒã„ã¡ã°ã‚“è¿‘ã„ã“ã‚ã¯ã€<strong>é›¨ãŒå¼·ã</strong>ãªã£ãŸã‚Šã€<strong>é¢¨ãŒã¨ã¦ã‚‚å¼·ã</strong>ãµãã‚„ã™ã„ã€‚</p>
        </div>
        <div class="info-item">
          <h4>â‘¢ é€šéå¾Œï¼šå¤©æ°—ã¯å›å¾©ãƒ»é¢¨å‘ãã‚‚å¤‰åŒ–</h4>
          <p>ä½æ°—åœ§ãŒé€šã‚Šéãã‚‹ã¨ã€<strong>é›²ãŒã¨ã‚Œ</strong>ã¦å¤©æ°—ãŒå›å¾©ã—ã€<strong>é¢¨å‘ããŒåŒ—ã‚ˆã‚Š</strong>ã«å¤‰ã‚ã‚‹ã“ã¨ãŒå¤šã„ã€‚</p>
        </div>
      </div>
    </section>

    <!-- â–¼ ã‚ã‹ã‚‹ç·¨ 3å• -->
    <section class="question-container">
      <div class="question-text" id="questionText"></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="choices" id="choicesContainer"></div>
      <div class="explanation" id="explanationBox">
        <h4>è§£èª¬</h4>
        <p id="explanationText"></p>
      </div>

      <div class="navigation">
        <button class="nav-btn prev-btn" id="prevBtn">å‰ã®å•é¡Œã¸</button>
        <button class="nav-btn next-btn" id="nextBtn">æ¬¡ã®å•é¡Œã¸</button>
      </div>
      <div id="historyDisplay"></div>
    </section>
  </main>

  <script>
    /************ LearningTracker ************/
    class LearningTracker {
      constructor(lessonId) {
        this.lessonId = lessonId;
        this.storageKey = "stepnavi_science_" + lessonId;
        this.currentSession = null;
        this.history = this.loadHistory();
      }

      loadHistory() {
        try {
          const raw = localStorage.getItem(this.storageKey);
          return raw ? JSON.parse(raw) : { sessions: [] };
        } catch (e) {
          console.warn("Failed to load history:", e);
          return { sessions: [] };
        }
      }

      startSession() {
        this.currentSession = {
          startedAt: Date.now(),
          answered: 0,
          correct: 0,
          records: []
        };
      }

      recordAnswer(questionIndex, isCorrect) {
        if (!this.currentSession) this.startSession();
        const now = Date.now();
        this.currentSession.answered += 1;
        if (isCorrect) this.currentSession.correct += 1;
        this.currentSession.records.push({
          questionIndex,
          isCorrect,
          answeredAt: now
        });

        this.postToParent("question:answered", {
          lessonId: this.lessonId,
          questionIndex,
          isCorrect,
          timestamp: now
        });
      }

      completeLesson(totalQuestions) {
        if (!this.currentSession) return;
        const now = Date.now();
        const durationMs = now - this.currentSession.startedAt;
        const summary = {
          ...this.currentSession,
          finishedAt: now,
          durationMs,
          totalQuestions
        };
        this.history.sessions.push(summary);
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.history));
        } catch (e) {
          console.warn("Failed to save history:", e);
        }

        this.postToParent("lesson:complete", {
          lessonId: this.lessonId,
          totalQuestions,
          answered: this.currentSession.answered,
          correct: this.currentSession.correct,
          durationMs
        });

        this.currentSession = null;
      }

      postToParent(type, payload) {
        try {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage({ type, payload }, "*");
          }
        } catch (e) {
          console.warn("postMessage failed:", e);
        }
      }
    }

    const LESSON_ID = "sci.earth.weather_fronts_sim";
    const tracker = new LearningTracker(LESSON_ID);

    /************ å¤©æ°—ã‚·ãƒŸãƒ¥åˆ¶å¾¡ ************/
    const timeSlider = document.getElementById("timeSlider");
    const timeDesc = document.getElementById("timeDesc");

    const mapScene = document.getElementById("mapScene");
    const lowCenter = document.getElementById("lowCenter");
    const frontLine = document.getElementById("frontLine");
    const cloud1 = document.getElementById("cloud1");
    const cloud2 = document.getElementById("cloud2");
    const cloud3 = document.getElementById("cloud3");
    const rainArea = document.getElementById("rainArea");
    const windArrow = document.getElementById("windArrow");

    const skyTag = document.getElementById("skyTag");
    const skyIcon = document.getElementById("skyIcon");
    const skyLabelText = document.getElementById("skyLabelText");

    const cloudText = document.getElementById("cloudText");
    const rainText = document.getElementById("rainText");
    const windText = document.getElementById("windText");
    const simComment = document.getElementById("simComment");

    const steps = [
      {
        label: "ä½æ°—åœ§ï¼šã¾ã é ã„",
        desc: "ã¾ã é›¢ã‚Œã¦ã„ã¦ã€å¤©æ°—ã¯ã¾ãšã¾ãš",
        icon: "ğŸŒ¤",
        cloud: "å°‘ãªã‚",
        rain: "ãªã—",
        rainClass: "",
        wind: "å¼±ã„é¢¨",
        windDeg: 0, // å³å‘ã
        comment: "<strong>â‘  ä½æ°—åœ§ãŒã¾ã é ã„ã¨ã</strong>ã¯ã€é›²ã¯å°‘ãªã‚ã§ã€é›¨ã‚‚ã»ã¨ã‚“ã©é™ã‚Šã¾ã›ã‚“ã€‚é¢¨ã‚‚å¼±ã„ã“ã¨ãŒå¤šã„ã§ã™ã€‚",
        lowX: 15, lowY: 35,
        frontX: 25, frontY: 55, frontScale: 0.7
      },
      {
        label: "ä½æ°—åœ§ï¼šè¿‘ã¥ã„ã¦ãã‚‹",
        desc: "é›²ãŒãµãˆã€ãƒãƒ„ãƒãƒ„é›¨ã‚‚",
        icon: "â˜ï¸",
        cloud: "ãµãˆã¯ã˜ã‚ã‚‹",
        rain: "å¼±ã„é›¨",
        rainClass: "rain-light",
        wind: "å—ã‚ˆã‚Šã®é¢¨",
        windDeg: 45, // å³ä¸Šâ†’
        comment: "<strong>â‘¡ è¿‘ã¥ã„ã¦ãã‚‹ã¨ã</strong>ã¯ã€ç©ºã«é›²ãŒãµãˆã€å¼±ã„é›¨ã‚„å—ã‚ˆã‚Šã®é¢¨ãŒå‡ºã¦ãã¾ã™ã€‚",
        lowX: 35, lowY: 38,
        frontX: 38, frontY: 52, frontScale: 0.9
      },
      {
        label: "ä½æ°—åœ§ï¼šçœŸä¸Šã‚’é€šéä¸­",
        desc: "é›¨ãƒ»é¢¨ã®ãƒ”ãƒ¼ã‚¯",
        icon: "ğŸŒ§",
        cloud: "ä¸€é¢ã®é›²",
        rain: "å¼·ã„é›¨",
        rainClass: "rain-strong",
        wind: "å¼·ã„é¢¨",
        windDeg: 90, // ä¸Šå‘ã
        comment: "<strong>â‘¢ çœŸä¸Šã‚’é€šã‚‹ã“ã‚</strong>ã¯ã€é›¨ã‚„é¢¨ãŒã„ã¡ã°ã‚“å¼·ããªã‚Šã‚„ã™ã„æ™‚é–“å¸¯ã§ã™ã€‚",
        lowX: 55, lowY: 40,
        frontX: 50, frontY: 50, frontScale: 1.1
      },
      {
        label: "ä½æ°—åœ§ï¼šæ±ã¸å»ã£ãŸã‚ã¨",
        desc: "å¤©æ°—ã¯å›å¾©ãƒ»é¢¨ã¯åŒ—ã‚ˆã‚Š",
        icon: "ğŸŒ¥",
        cloud: "é›²ãŒããˆã¦ã„ã",
        rain: "ã‚„ã‚€",
        rainClass: "",
        wind: "åŒ—ã‚ˆã‚Šã®é¢¨",
        windDeg: -45, // å³ä¸‹â†’
        comment: "<strong>â‘£ é€šã‚ŠéããŸã‚ã¨</strong>ã¯ã€é›²ãŒã¨ã‚Œã¦å¤©æ°—ãŒå›å¾©ã—ã€åŒ—ã‚ˆã‚Šã®é¢¨ã«å¤‰ã‚ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚",
        lowX: 78, lowY: 30,
        frontX: 65, frontY: 45, frontScale: 1.0
      }
    ];

    function updateWeatherScene(stepIndex) {
      const s = steps[stepIndex];

      timeDesc.textContent = s.desc;
      skyTag.textContent = s.label;
      skyIcon.textContent = s.icon;
      skyLabelText.textContent = s.cloud + "ãƒ»" + s.rain;

      cloudText.textContent = s.cloud;
      rainText.textContent = s.rain;
      windText.textContent = s.wind;
      simComment.innerHTML = s.comment;

      // ä½æ°—åœ§ã®ä½ç½®ï¼ˆ%æŒ‡å®šã‚’pxã«å¤‰æ›ï¼šã“ã“ã§ã¯å˜ç´”ã«å‰²åˆï¼‰
      const mapRect = mapScene.getBoundingClientRect();
      const lw = mapRect.width;
      const lh = mapRect.height;
      lowCenter.style.left = s.lowX + "%";
      lowCenter.style.top = s.lowY + "%";

      // å‰ç·š
      frontLine.style.left = s.frontX + "%";
      frontLine.style.top = s.frontY + "%";
      frontLine.style.width = (lw * s.frontScale * 0.008 + 80) + "px";

      // é›²ä½ç½®ï¼ˆã–ã£ãã‚Šï¼‰
      cloud1.style.left = (s.lowX - 8) + "%";
      cloud1.style.top = (s.lowY - 25) + "%";
      cloud2.style.left = (s.lowX + 5) + "%";
      cloud2.style.top = (s.lowY - 10) + "%";
      cloud3.style.left = (s.lowX - 15) + "%";
      cloud3.style.top = (s.lowY + 5) + "%";

      // é›¨ã‚¯ãƒ©ã‚¹
      mapScene.classList.remove("rain-light","rain-strong");
      if (s.rainClass) mapScene.classList.add(s.rainClass);

      // é¢¨å‘ãçŸ¢å°
      windArrow.style.transform = "rotate(" + s.windDeg + "deg)";

    }

    window.addEventListener("resize", () => {
      updateWeatherScene(parseInt(timeSlider.value, 10));
    });

    timeSlider.addEventListener("input", () => {
      const idx = parseInt(timeSlider.value, 10);
      updateWeatherScene(idx);
    });

    // åˆæœŸè¡¨ç¤º
    updateWeatherScene(0);

    /************ ã‚ã‹ã‚‹ç·¨ï¼šå•é¡Œãƒ‡ãƒ¼ã‚¿ ************/
    const questions = [
      {
        id: "q1",
        text: "ä½æ°—åœ§ã¨å‰ç·šãŒè¿‘ã¥ã„ã¦ãã‚‹ã¨ãã€å¤©æ°—ã®å¤‰åŒ–ã¨ã—ã¦æ­£ã—ã„ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
        choices: [
          "é›²ãŒã¸ã£ã¦ã€ã„ã¤ã‚‚å¿«æ™´ã«ãªã‚‹",
          "é›²ãŒãµãˆã€é›¨ã‚„é¢¨ãŒã—ã ã„ã«å¼·ã¾ã‚‹ã“ã¨ãŒå¤šã„",
          "ã„ããªã‚Šå¤§é›ªã«ãªã‚‹",
          "å¤©æ°—ã‚‚é¢¨ã‚‚ã¾ã£ãŸãå¤‰åŒ–ã—ãªã„"
        ],
        correct: 1,
        explanation:
          "ä½æ°—åœ§ã‚„å‰ç·šãŒè¿‘ã¥ãã¨ã€ç©ºã«<strong>é›²ãŒãµãˆ</strong>ã€ãã®ã‚ã¨<strong>é›¨ã‚„é¢¨ãŒå¼·ã¾ã‚‹</strong>ã“ã¨ãŒå¤šã„ã§ã™ã€‚æ€¥ã«ä½•ã‚‚ã‹ã‚‚å¤‰ã‚ã‚‹ã®ã§ã¯ãªãã€ã€Œã ã‚“ã ã‚“å¤‰åŒ–ã™ã‚‹ã€ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚"
      },
      {
        id: "q2",
        text: "æ—¥æœ¬ä»˜è¿‘ã‚’ä½æ°—åœ§ãŒé€šéã—ãŸã‚ã¨ï¼ˆä½æ°—åœ§ãŒæ—¥æœ¬ã®æ±ã®æµ·ä¸Šã«ã¬ã‘ãŸã‚ã¨ï¼‰ã€æ—¥æœ¬ä»˜è¿‘ã§ã‚ˆããµãé¢¨ã®å‘ãã¨ã—ã¦æœ€ã‚‚é©ã—ã¦ã„ã‚‹ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
        choices: [
          "å—ã‚ˆã‚Šã®é¢¨ï¼ˆã‚ãŸãŸã‹ã„é¢¨ï¼‰",
          "åŒ—ã‚ˆã‚Šã®é¢¨ï¼ˆã¤ã‚ãŸã„é¢¨ï¼‰",
          "ã„ã¤ã‚‚æ±ã‚ˆã‚Šã®é¢¨ã«ãªã‚‹",
          "é¢¨ãŒå¿…ãšæ­¢ã¾ã‚‹"
        ],
        correct: 1,
        explanation:
          "æ—¥æœ¬ä»˜è¿‘ã§ã¯ã€ä½æ°—åœ§ã®<strong>å‰é¢</strong>ã§å—ã‚ˆã‚Šã®é¢¨ã€<strong>å¾Œé¢</strong>ã§åŒ—ã‚ˆã‚Šã®é¢¨ãŒãµãã“ã¨ãŒå¤šããªã‚Šã¾ã™ã€‚ä½æ°—åœ§ãŒæ—¥æœ¬ã®æ±ã¸æŠœã‘ãŸã‚ã¨ã¯ã€<strong>åŒ—ã‚ˆã‚Šã®é¢¨</strong>ãŒãµãã€æ°—æ¸©ãŒä¸‹ãŒã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚"
      },
      {
        id: "q3",
        text: "å¤©æ°—å›³ã§ã€ä½æ°—åœ§ï¼ˆLï¼‰ã¨é«˜æ°—åœ§ï¼ˆHï¼‰ãŒãªã‚‰ã³ã€ç­‰åœ§ç·šãŒã›ã¾ãã¤ã¾ã£ã¦ã„ã‚‹ã¨ãã®ã‚ˆã†ã™ã¨ã—ã¦ã€æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
        choices: [
          "é¢¨ãŒå¼·ããµãã‚„ã™ã„",
          "é¢¨ã¯ã¨ã¦ã‚‚å¼±ã„",
          "ã„ã¤ã‚‚ãã‚‚ã‚Šã§é›¨ã¯é™ã‚‰ãªã„",
          "å¿…ãšå°é¢¨ãŒè¿‘ã¥ã„ã¦ã„ã‚‹"
        ],
        correct: 0,
        explanation:
          "å¤©æ°—å›³ã§ç­‰åœ§ç·šãŒ<strong>ã›ã¾ãã¤ã¾ã£ã¦ã„ã‚‹</strong>ã¨ã“ã‚ã»ã©ã€æ°—åœ§ã®å¤‰åŒ–ãŒå¤§ããã€<strong>é¢¨ãŒå¼·ã</strong>ãµãã‚„ã™ããªã‚Šã¾ã™ã€‚å°é¢¨ã§ãªãã¦ã‚‚ã€ä½æ°—åœ§ã‚„å‰ç·šã®é€šéã§å¼·ã„é¢¨ãŒãµãã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚"
      }
    ];

    let currentQuestionIndex = 0;
    let answeredFlags = new Array(questions.length).fill(false);

    const questionTextEl = document.getElementById("questionText");
    const choicesContainer = document.getElementById("choicesContainer");
    const explanationBox = document.getElementById("explanationBox");
    const explanationText = document.getElementById("explanationText");
    const progressFill = document.getElementById("progressFill");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function renderQuestion(index) {
      const q = questions[index];
      questionTextEl.textContent = "Q" + (index + 1) + ". " + q.text;
      choicesContainer.innerHTML = "";
      explanationBox.classList.remove("show");
      explanationText.innerHTML = "";

      q.choices.forEach((choiceText, i) => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.textContent = choiceText;
        btn.dataset.index = i;
        btn.addEventListener("click", () => handleChoiceClick(index, i, btn));
        choicesContainer.appendChild(btn);
      });

      updateProgress();
      updateNavButtons();
    }

    function handleChoiceClick(qIndex, choiceIndex, btnEl) {
      const q = questions[qIndex];

      if (answeredFlags[qIndex]) return;

      const allChoices = choicesContainer.querySelectorAll(".choice");
      allChoices.forEach(el => el.disabled = true);

      const isCorrect = (choiceIndex === q.correct);
      answeredFlags[qIndex] = true;

      if (isCorrect) {
        btnEl.classList.add("correct");
      } else {
        btnEl.classList.add("incorrect");
        const correctBtn = allChoices[q.correct];
        if (correctBtn) correctBtn.classList.add("correct");
      }

      explanationBox.classList.add("show");
      explanationText.innerHTML = q.explanation;

      tracker.recordAnswer(qIndex, isCorrect);

      updateProgress();
      updateNavButtons();

      if (answeredFlags.every(f => f)) {
        // ã™ã¹ã¦ã®å•é¡Œã«å›ç­”ã—ãŸå ´åˆã€å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
        nextBtn.disabled = true;
        prevBtn.disabled = true;
        nextBtn.style.opacity = "0.5";
        prevBtn.style.opacity = "0.5";
        
        setTimeout(() => {
          if (answeredFlags.every(f => f)) {
            showCompletionScreen();
          }
        }, 2000);
      }
    }

    function updateProgress() {
      const answeredCount = answeredFlags.filter(f => f).length;
      const ratio = answeredCount / questions.length;
      progressFill.style.width = (ratio * 100) + "%";
    }

    function updateNavButtons() {
      // ã™ã¹ã¦ã®å•é¡Œã«å›ç­”æ¸ˆã¿ã®å ´åˆã¯ã€å®Œäº†ç”»é¢è¡¨ç¤ºä¸­ãªã®ã§ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      if (answeredFlags.every(f => f)) {
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        return;
      }
      prevBtn.disabled = (currentQuestionIndex === 0);
      nextBtn.disabled = (currentQuestionIndex === questions.length - 1);
    }

    prevBtn.addEventListener("click", () => {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion(currentQuestionIndex);
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        renderQuestion(currentQuestionIndex);
      } else {
        // æœ€å¾Œã®å•é¡Œã§ã€Œæ¬¡ã®å•é¡Œã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
        if (answeredFlags.every(f => f)) {
          showCompletionScreen();
        }
      }
    });

    tracker.startSession();
    renderQuestion(currentQuestionIndex);

    function showCompletionScreen() {
      // å­¦ç¿’å±¥æ­´ã‚’ä¿å­˜
      tracker.saveSession();
      
      // ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†æ™‚ã«ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å‰Šé™¤
      clearCheckpoint();
      
      // UIã‚’å®Œäº†ç”»é¢ã«å¤‰æ›´
      questionTextEl.textContent = "å­¦ç¿’å®Œäº†ï¼ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸã€‚";
      choicesContainer.innerHTML = "";
      explanationBox.classList.remove("show");
      explanationText.innerHTML = "";
      
      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
      nextBtn.style.display = "none";
      prevBtn.style.display = "none";
      
      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
      progressFill.style.width = "100%";
      
      // ä»Šå›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœã‚’è¡¨ç¤º
      const historyDisplay = document.getElementById("historyDisplay");
      if (historyDisplay) {
        historyDisplay.innerHTML = showCurrentSessionResult();
        historyDisplay.style.display = "block";
        historyDisplay.style.visibility = "visible";
        historyDisplay.style.opacity = "1";
      }
      
      // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦ªãƒ•ãƒ¬ãƒ¼ãƒ ã«é€ä¿¡
      const totalQuestions = questions.length;
      const messageData = {
        type: 'lesson:complete',
        lessonId: LESSON_ID,
        detail: {
          correct: tracker.currentSession ? tracker.currentSession.correct : 0,
          total: totalQuestions,
          timeSec: tracker.currentSession ? Math.floor((Date.now() - tracker.currentSession.startedAt) / 1000) : 0
        }
      };
      
      try {
        if (window.parent && window.parent !== window) {
          window.parent.postMessage(messageData, "*");
        } else {
          window.parent.postMessage(messageData, "*");
        }
      } catch (e) {
        console.warn("postMessage failed:", e);
      }
      
      // completeLessonã‚‚å‘¼ã³å‡ºã—ã¦å±¥æ­´ã«è¨˜éŒ²
      tracker.completeLesson(totalQuestions);
    }

    function clearCheckpoint() {
      try {
        const checkpointKey = `checkpoint:${LESSON_ID}`;
        localStorage.removeItem(checkpointKey);
        return true;
      } catch (error) {
        console.error('âŒ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        return false;
      }
    }

    function showCurrentSessionResult() {
      const session = tracker.currentSession;
      if (!session) return '';
      
      const totalQuestions = questions.length;
      const correct = session.correct || 0;
      const scorePercent = totalQuestions > 0 ? 
        Math.round((correct / totalQuestions) * 100) : 0;
      
      // æˆç¸¾ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      let resultMessage = '';
      if (scorePercent >= 90) {
        resultMessage = 'ğŸ‰ ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ï¼';
      } else if (scorePercent >= 70) {
        resultMessage = 'ğŸ‘ ã‚ˆãã§ãã¾ã—ãŸï¼';
      } else if (scorePercent >= 50) {
        resultMessage = 'ğŸ’ª ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
      } else {
        resultMessage = 'ğŸ“š å¾©ç¿’ã—ã¦å†æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼';
      }
      
      return `
        <div style="padding: 16px; background: #f8f9fa; border-radius: 12px; margin-top: 12px;">
          <h3 style="margin-bottom: 12px; color: #333; font-size: 16px;">ä»Šå›ã®çµæœ</h3>
          <p style="margin: 8px 0; color: #555; font-size: 14px;">
            <strong>æ­£è§£æ•°:</strong> ${correct} / ${totalQuestions} å•
          </p>
          <p style="margin: 8px 0; color: #555; font-size: 14px;">
            <strong>æ­£ç­”ç‡:</strong> ${scorePercent}%
          </p>
          <p style="margin: 12px 0 0 0; color: #1976d2; font-size: 15px; font-weight: bold;">
            ${resultMessage}
          </p>
        </div>
      `;
    }

    /************ ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ ************/
    function goHome(){
      window.location.href = '/';
    }
  </script>
</body>
</html>
