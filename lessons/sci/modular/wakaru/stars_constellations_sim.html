<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å­¦ã¶ç†ç§‘ - æ˜Ÿã¨æ˜Ÿåº§</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: "Hiragino Sans", "Yu Gothic", sans-serif;
      background: radial-gradient(circle at top, #0d1b2a 0%, #000814 45%, #02010a 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color:#f1f5f9;
    }
    .header {
      background: rgba(3, 4, 94, 0.95);
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 12px rgba(0,0,0,0.5);
      backdrop-filter: blur(8px);
    }
    .home-btn {
      background:linear-gradient(135deg,#00b4d8,#48cae4);
      color:white;
      border:none;
      padding:10px 18px;
      border-radius:20px;
      font-size:14px;
      cursor:pointer;
      transition:all 0.3s ease;
      min-height:44px;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      box-shadow:0 2px 8px rgba(0,0,0,0.4);
    }
    .home-btn:hover { background:#00a0c6; transform:translateY(-1px); }
    .home-btn:active { transform:scale(0.97); }
    .lesson-title {
      font-size:18px;
      font-weight:bold;
      color:#e0f7fa;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      flex:1;
      margin:0 10px;
      text-align:center;
    }
    .main-container {
      flex:1;
      display:flex;
      flex-direction:column;
      padding:15px;
      gap:12px;
    }

    /* â–¼ ã‚·ãƒŸãƒ¥å…¨ä½“ */
    .sim-container {
      background:rgba(4, 18, 38, 0.96);
      border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,0.7);
      margin-bottom:10px;
      overflow:hidden;
      position:relative;
      border:1px solid rgba(148, 163, 184, 0.4);
    }
    .sim-header {
      background:radial-gradient(circle at top, #1b263b 0%, #0b1320 60%, #000814 100%);
      color:#e0f7fa;
      padding:14px 15px;
      text-align:center;
      border-bottom:1px solid rgba(148,163,184,0.4);
    }
    .sim-header h2 { font-size:20px; margin-bottom:5px; }
    .sim-header p { font-size:13px; opacity:0.9; }

    .sim-area {
      padding:12px 12px 16px;
    }

    .control-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    .control-label {
      font-size:13px;
      font-weight:bold;
      color:#a5f3fc;
      min-width:120px;
    }
    .season-tabs {
      display:flex;
      gap:8px;
      flex:1;
    }
    .season-btn {
      flex:1;
      border:none;
      border-radius:20px;
      padding:10px 8px;
      font-size:13px;
      cursor:pointer;
      background:rgba(25,118,210,0.25);
      color:#bbdefb;
      font-weight:bold;
      min-height:40px;
      transition:all .25s ease;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      box-shadow:0 2px 6px rgba(0,0,0,0.6);
      display:flex;
      justify-content:center;
      align-items:center;
      gap:4px;
    }
    .season-btn span.emoji{font-size:16px;}
    .season-btn.active {
      background:linear-gradient(135deg,#42a5f5,#ab47bc);
      color:#fff;
      box-shadow:0 4px 14px rgba(0,0,0,0.85);
      transform:translateY(-1px);
    }
    .season-desc {
      min-width:120px;
      font-size:11px;
      text-align:right;
      color:#c5cae9;
    }

    .sim-field {
      margin-top:0;
      margin-bottom:12px;
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
      gap:10px;
    }

    /* â–¼ å…¬è»¢å›³å´ */
    .orbit-panel {
      position:relative;
      border-radius:14px;
      background:radial-gradient(circle at center,#1a237e 0%,#000015 55%,#000 100%);
      min-height:180px;
      overflow:visible;
      box-shadow:inset 0 0 30px rgba(0,0,0,0.9);
      border:1px solid rgba(144,202,249,0.3);
    }
    .starfield {
      position:absolute;
      inset:0;
      background-image:
        radial-gradient(2px 2px at 10% 20%,rgba(255,255,255,0.9),transparent),
        radial-gradient(1.5px 1.5px at 30% 80%,rgba(187,222,251,0.9),transparent),
        radial-gradient(1.5px 1.5px at 70% 30%,rgba(255,255,255,0.8),transparent),
        radial-gradient(2px 2px at 90% 60%,rgba(179,229,252,0.95),transparent),
        radial-gradient(1px 1px at 20% 60%,rgba(255,255,255,0.7),transparent);
      opacity:.6;
      animation:twinkle 6s ease-in-out infinite alternate;
    }
    @keyframes twinkle {
      0% {opacity:.4;transform:scale(1);}
      50% {opacity:.9;transform:scale(1.02);}
      100% {opacity:.5;transform:scale(1.01);}
    }

    .sun {
      position:absolute;
      left:50%;
      top:50%;
      width:12px;
      height:12px;
      margin:-6px 0 0 -6px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#fff59d,#ffca28,#f57f17);
      box-shadow:0 0 10px rgba(255,235,59,0.8),0 0 20px rgba(255,193,7,0.6);
      animation:pulseSun 4s ease-in-out infinite;
    }
    @keyframes pulseSun {
      0%,100% {transform:scale(1);}
      50% {transform:scale(1.05);}
    }

    .orbit {
      position:absolute;
      left:50%;
      top:50%;
      width:90px;
      height:65px;
      margin:-32.5px 0 0 -45px;
      border-radius:50%;
      border:1px dashed rgba(144,202,249,0.6);
      transform:rotate(-20deg);
      box-shadow:0 0 20px rgba(144,202,249,0.4);
    }

    .earth-orbit-pos {
      position:absolute;
      left:50%;
      top:50%;
      width:90px;
      height:65px;
      margin:-32.5px 0 0 -45px;
      transform:rotate(-20deg);
      transform-origin:50% 50%;
      transition:transform .8s ease-in-out;
    }
    .earth {
      position:absolute;
      width:9px;
      height:9px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#e3f2fd,#42a5f5,#1a237e);
      box-shadow:0 0 6px rgba(129,212,250,0.9);
      top:50%;
      left:100%;
      margin:-4.5px 0 0 -4.5px;
    }
    .earth::after {
      content:"ğŸŒ";
      position:absolute;
      inset:0;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:8px;
      text-shadow:0 0 3px rgba(0,0,0,0.7);
    }

    .night-arrow {
      position:absolute;
      top:50%;
      left:100%;
      width:100px;
      height:3px;
      background:linear-gradient(90deg,transparent,rgba(187,222,251,0.9),#bbdefb);
      transform-origin:0 50%;
      transform:translateY(-50%);
      transition:transform .8s ease-in-out;
      opacity:1;
      box-shadow:0 0 8px rgba(187,222,251,0.6);
    }
    .night-arrow-label {
      position:absolute;
      right:-8px;
      top:-24px;
      font-size:13px;
      font-weight:600;
      color:#e3f2fd;
      text-shadow:0 0 8px rgba(0,0,0,0.9), 0 0 4px rgba(187,222,251,0.8);
      white-space:nowrap;
      pointer-events:none;
    }

    .pole-star {
      position:absolute;
      top:12%;
      left:50%;
      width:4px;
      height:4px;
      margin:-2px 0 0 -2px;
      border-radius:50%;
      background:#fff;
      box-shadow:0 0 8px rgba(255,255,255,0.9), 0 0 12px rgba(255,255,255,0.6);
      opacity:0.9;
      animation:twinkle 3s ease-in-out infinite alternate;
      z-index:10;
      /* åœ°è»¸ã®å‚¾ãï¼ˆç´„23.4åº¦ï¼‰ã‚’è€ƒæ…®ã—ã¦ã€ã‚ãšã‹ã«å³ã«ã‚·ãƒ•ãƒˆ */
      transform:translateX(8px);
    }
    .pole-star::after {
      content:"åŒ—æ¥µæ˜Ÿ";
      position:absolute;
      left:50%;
      top:-20px;
      transform:translateX(-50%);
      font-size:10px;
      color:#fff;
      text-shadow:0 0 4px rgba(0,0,0,0.9);
      white-space:nowrap;
    }

    /* â–¼ å¤œç©ºãƒ»æ˜Ÿåº§ãƒ‘ãƒãƒ« */
    .sky-panel {
      position:relative;
      border-radius:14px;
      background:radial-gradient(circle at top,#1a237e 0%,#000015 65%,#000 100%);
      min-height:230px;
      overflow:hidden;
      box-shadow:inset 0 0 30px rgba(0,0,0,0.9);
      border:1px solid rgba(179,136,255,0.5);
    }
    .sky-stars {
      position:absolute;
      inset:0;
      background-image:
        radial-gradient(1.5px 1.5px at 15% 10%,rgba(255,255,255,0.9),transparent),
        radial-gradient(2px 2px at 60% 25%,rgba(206,147,216,0.95),transparent),
        radial-gradient(1.5px 1.5px at 85% 70%,rgba(129,212,250,0.9),transparent),
        radial-gradient(1.2px 1.2px at 35% 80%,rgba(255,255,255,0.8),transparent),
        radial-gradient(1.2px 1.2px at 70% 50%,rgba(255,241,118,0.9),transparent);
      opacity:.7;
      animation:twinkle 5.5s ease-in-out infinite alternate;
    }
    .sky-horizon {
      position:absolute;
      left:-10%;
      right:-10%;
      bottom:-5%;
      height:40%;
      background:linear-gradient(to top,#263238 0%,transparent 80%);
    }

    .constellation-name {
      position:absolute;
      bottom:14px;
      left:14px;
      padding:7px 11px;
      border-radius:18px;
      background:rgba(0,0,0,0.7);
      border:1px solid rgba(187,222,251,0.6);
      font-size:12px;
      display:flex;
      align-items:center;
      gap:5px;
    }
    .constellation-name span.emoji {
      font-size:18px;
      filter:drop-shadow(0 0 4px rgba(255,255,255,0.8));
      animation:float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%,100% {transform:translateY(0);}
      50% {transform:translateY(-3px);}
    }

    .constellation-lines {
      position:absolute;
      inset:18% 10% 32% 10%;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .constellation-svg {
      width:100%;
      height:100%;
      filter:drop-shadow(0 0 6px rgba(255,255,255,0.7));
    }
    .constellation-svg line {
      stroke:#fff;
      stroke-width:1.2;
      stroke-linecap:round;
      stroke-dasharray:4 3;
      animation:drawLine 4s linear infinite alternate;
    }
    .constellation-svg circle {
      fill:#fff;
      animation:twinkle 4s ease-in-out infinite alternate;
    }
    @keyframes drawLine {
      0% {stroke-dashoffset:20;}
      100% {stroke-dashoffset:0;}
    }

    /* åŒ—æ–—ä¸ƒæ˜Ÿï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ */
    .dipper {
      position:absolute;
      top:15%;
      left:10%;
      width:35%;
      height:25%;
    }
    .dipper-svg {
      width:100%;
      height:100%;
      filter:drop-shadow(0 0 4px rgba(255,255,255,0.6));
    }
    .dipper-svg line {
      stroke:#e3f2fd;
      stroke-width:1.5;
      stroke-linecap:round;
      opacity:0.8;
    }
    .dipper-svg circle {
      fill:#fff;
      opacity:0.9;
    }

    .season-caption {
      position:absolute;
      top:10px;
      right:12px;
      font-size:11px;
      padding:5px 9px;
      border-radius:14px;
      background:rgba(0,0,0,0.65);
      border:1px solid rgba(187,222,251,0.5);
    }

    .sim-comment {
      margin-top:10px;
      font-size:13px;
      line-height:1.7;
      color:#e3f2fd;
      background:linear-gradient(135deg,rgba(13,71,161,0.8),rgba(81,45,168,0.85));
      border-radius:12px;
      padding:10px 12px;
      border-left:5px solid #42a5f5;
      box-shadow:0 2px 10px rgba(0,0,0,0.8);
    }
    .sim-comment strong {color:#fff59d;}

    /* â–¼ infoãƒ‘ãƒãƒ« */
    .info-panel {
      background:rgba(13,13,40,0.96);
      border-radius:16px;
      box-shadow:0 10px 35px rgba(0,0,0,0.8);
      padding:18px;
    }
    .info-panel h3 {
      font-size:17px;
      margin-bottom:12px;
      color:#e3f2fd;
    }
    .info-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;
    }
    .info-item {
      background:rgba(21,21,60,0.9);
      padding:12px;
      border-radius:10px;
      border-left:4px solid #42a5f5;
    }
    .info-item h4 {
      font-size:14px;
      color:#bbdefb;
      margin-bottom:6px;
    }
    .info-item p {
      font-size:13px;
      color:#e0e0e0;
      line-height:1.5;
    }

    /* â–¼ å•é¡Œãƒ‘ãƒãƒ« */
    .question-container {
      background:rgba(255,255,255,0.98);
      border-radius:16px;
      box-shadow:0 10px 35px rgba(0,0,0,0.3);
      padding:20px;
      margin-bottom:6px;
      border:2px solid rgba(66,165,245,0.3);
    }
    .question-text {
      font-size:18px;
      font-weight:bold;
      margin-bottom:16px;
      color:#1a237e;
      line-height:1.7;
      background:linear-gradient(135deg, rgba(66,165,245,0.1), rgba(171,71,188,0.1));
      padding:14px 16px;
      border-radius:10px;
      border-left:4px solid #42a5f5;
    }
    .progress-bar {
      background:#e0e0e0;
      border-radius:8px;
      height:10px;
      margin:12px 0 18px;
      overflow:hidden;
      box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);
    }
    .progress-fill {
      background:linear-gradient(90deg,#42a5f5,#ab47bc);
      height:100%;
      width:0;
      transition:width .3s ease;
      box-shadow:0 0 8px rgba(66,165,245,0.5);
    }
    .choices {
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .choice {
      padding:14px 16px;
      background:#ffffff;
      border:2px solid #e0e0e0;
      border-radius:10px;
      cursor:pointer;
      transition:all .25s ease;
      font-size:15px;
      min-height:52px;
      display:flex;
      align-items:center;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      color:#212121;
      font-weight:500;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .choice:hover {
      background:#f5f5f5;
      border-color:#42a5f5;
      box-shadow:0 4px 8px rgba(66,165,245,0.2);
      transform:translateY(-1px);
    }
    .choice.correct {
      background:#4caf50;
      border-color:#66bb6a;
      animation:correctPulse .6s ease;
      color:#ffffff;
      font-weight:bold;
      box-shadow:0 4px 12px rgba(76,175,80,0.4);
    }
    .choice.incorrect {
      background:#f44336;
      border-color:#ef5350;
      animation:wrongShake .6s ease;
      color:#ffffff;
      font-weight:bold;
      box-shadow:0 4px 12px rgba(244,67,54,0.4);
    }
    @keyframes correctPulse {
      0%,100% {transform:scale(1);}
      50% {transform:scale(1.05);}
    }
    @keyframes wrongShake {
      0%,100% {transform:translateX(0);}
      25% {transform:translateX(-8px);}
      75% {transform:translateX(8px);}
    }
    .explanation {
      margin-top:16px;
      padding:16px;
      background:linear-gradient(135deg, rgba(66,165,245,0.1), rgba(171,71,188,0.1));
      border-radius:10px;
      border-left:4px solid #42a5f5;
      display:none;
      font-size:14px;
      line-height:1.8;
      color:#212121;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .explanation.show {display:block;}
    .explanation h4 {
      color:#1a237e;
      margin-bottom:10px;
      font-size:15px;
      font-weight:bold;
    }
    .explanation p {
      color:#424242;
      margin:0;
    }
    .navigation {
      margin-top:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .nav-btn {
      padding:12px 20px;
      border:none;
      border-radius:22px;
      font-size:14px;
      font-weight:bold;
      cursor:pointer;
      transition:all .25s ease;
      min-height:44px;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }
    .nav-btn:disabled {
      opacity:.4;
      cursor:not-allowed;
    }
    .prev-btn {
      background:#757575;
      color:#ffffff;
      font-weight:bold;
    }
    .prev-btn:hover:not(:disabled) {
      background:#616161;
      box-shadow:0 4px 8px rgba(0,0,0,0.2);
    }
    .next-btn {
      background:linear-gradient(135deg, #42a5f5, #ab47bc);
      color:#ffffff;
      font-weight:bold;
      box-shadow:0 4px 12px rgba(66,165,245,0.4);
    }
    .next-btn:hover:not(:disabled) {
      background:linear-gradient(135deg, #1e88e5, #8e24aa);
      box-shadow:0 6px 16px rgba(66,165,245,0.5);
      transform:translateY(-1px);
    }

    * {touch-action:manipulation;}
    .choice,.nav-btn,.home-btn,.season-btn {-webkit-tap-highlight-color:transparent;}

    @media(max-width:768px){
      .main-container {padding:10px;}
      .sim-field {
        grid-template-columns:1fr;
      }
      .orbit-panel {min-height:160px;}
      .question-container,.info-panel {padding:16px;}
      .question-text {
        font-size:16px;
        padding:12px 14px;
        line-height:1.6;
      }
      .choice {
        font-size:14px;
        padding:13px 15px;
        min-height:50px;
      }
      .explanation {
        font-size:13px;
        padding:14px;
        line-height:1.7;
      }
      .info-grid {grid-template-columns:1fr;}
      .lesson-title {font-size:14px;}
    }
  </style>
</head>
<body>
<header class="header">
  <button class="home-btn" onclick="goHome()">ãƒ›ãƒ¼ãƒ </button>
  <div class="lesson-title">æ˜Ÿã¨æ˜Ÿåº§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€ã¨æ˜Ÿåº§ï¼‰</div>
  <div style="width:80px;"></div>
</header>

<main class="main-container">
  <!-- â–¼ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
  <section class="sim-container">
    <div class="sim-header">
      <h2>åœ°çƒã®å…¬è»¢ã¨ å­£ç¯€ã®æ˜Ÿåº§ã®è¦‹ãˆæ–¹</h2>
      <p>æ˜¥ãƒ»å¤ãƒ»ç§‹ãƒ»å†¬ã§ã€Œå¤œã«è¦‹ãˆã‚‹æ˜Ÿåº§ã€ãŒå¤‰ã‚ã‚‹ã®ã¯ã€åœ°çƒãŒå¤ªé™½ã®ã¾ã‚ã‚Šã‚’å…¬è»¢ã—ã¦ã„ã‚‹ã‹ã‚‰ã ã‚ˆã€‚</p>
    </div>
    <div class="sim-area">
      <div class="sim-field">
        <!-- å…¬è»¢å›³ -->
        <div class="orbit-panel">
          <div class="starfield"></div>
          <div class="sun"></div>
          <div class="orbit"></div>
          <div class="pole-star"></div>
          <div class="earth-orbit-pos" id="earthOrbit">
            <div class="earth"></div>
            <div class="night-arrow" id="nightArrow">
              <div class="night-arrow-label" id="nightArrowLabel">å¤œã®ç©ºã®å‘ã</div>
            </div>
          </div>
        </div>

      </div>

      <div class="sim-comment" id="simComment">
        <strong>æ˜¥åˆ†ã®ã“ã‚</strong>ã€å¤œã«ã¯å¤ªé™½ã¨åå¯¾å´ã®ç©ºã«ã‚ã‚‹ã€Œã—ã—åº§ã€ãªã©ãŒã‚ˆãè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚åœ°çƒãŒå¤ªé™½ã®ã¾ã‚ã‚Šã‚’å‹•ãã“ã¨ã§ã€å¤œã«å‘ã„ã¦ã„ã‚‹æ–¹å‘ãŒå°‘ã—ãšã¤å¤‰ã‚ã‚Šã€å­£ç¯€ã”ã¨ã«è¦‹ãˆã‚‹æ˜Ÿåº§ãŒå¤‰åŒ–ã—ã¾ã™ã€‚
      </div>

      <!-- æ“ä½œUIã‚’ä¸‹ã«é…ç½® -->
      <div class="control-row">
        <div class="control-label">å­£ç¯€ã‚’ãˆã‚‰ã¶</div>
        <div class="season-tabs">
          <button class="season-btn active" data-season="spring" id="btnSpring">
            <span class="emoji">ğŸŒ¸</span><span>æ˜¥</span>
          </button>
          <button class="season-btn" data-season="summer" id="btnSummer">
            <span class="emoji">ğŸŒ»</span><span>å¤</span>
          </button>
          <button class="season-btn" data-season="autumn" id="btnAutumn">
            <span class="emoji">ğŸ</span><span>ç§‹</span>
          </button>
          <button class="season-btn" data-season="winter" id="btnWinter">
            <span class="emoji">â„ï¸</span><span>å†¬</span>
          </button>
        </div>
        <div class="season-desc" id="seasonDesc">æ˜¥ã®å¤œï¼šã—ã—åº§ãŒã‚ˆãè¦‹ãˆã‚‹</div>
      </div>
    </div>
  </section>

  <!-- â–¼ å°å…¥ãƒ†ã‚­ã‚¹ãƒˆ(info-panel) -->
  <section class="info-panel">
    <h3>å­£ç¯€ã”ã¨ã«å¤‰ã‚ã‚‹æ˜Ÿåº§</h3>
    <div class="info-grid">
      <div class="info-item">
        <h4>â‘  åœ°çƒã®å…¬è»¢ã¨å­£ç¯€ã®æ˜Ÿåº§</h4>
        <p>
          åœ°çƒã¯ä¸€å¹´ã‹ã‘ã¦å¤ªé™½ã®ã¾ã‚ã‚Šã‚’<strong>å…¬è»¢</strong>ã—ã¦ã„ã¾ã™ã€‚åœ°çƒã®ä½ç½®ãŒå¤‰ã‚ã‚‹ã¨ã€å¤œã«å¤ªé™½ã¨åå¯¾å´ã«è¦‹ãˆã‚‹å®‡å®™ã®æ–¹å‘ã‚‚å¤‰ã‚ã‚‹ãŸã‚ã€
          æ˜¥ã«ã¯ã—ã—åº§ã€å¤ã«ã¯ã•ãã‚Šåº§ã€ç§‹ã«ã¯ãƒšã‚¬ã‚¹ã‚¹åº§ã€å†¬ã«ã¯ã‚ªãƒªã‚ªãƒ³åº§ã®ã‚ˆã†ã«ã€å­£ç¯€ã”ã¨ã«ä¸»å½¹ã«ãªã‚‹æ˜Ÿåº§ãŒå…¥ã‚Œã‹ã‚ã‚Šã¾ã™ã€‚
        </p>
      </div>
      <div class="info-item">
        <h4>â‘¡ å­£ç¯€ã®ä»£è¡¨çš„ãªæ˜Ÿåº§</h4>
        <p>
          ãã‚Œãã‚Œã®å­£ç¯€ã«ã¯ã€å½¢ãŒåˆ†ã‹ã‚Šã‚„ã™ã„<strong>ä»£è¡¨çš„ãªæ˜Ÿåº§</strong>ãŒã‚ã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ã€æ˜¥ã¯<strong>ã—ã—åº§</strong>ã€å¤ã¯èµ¤ã„ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹ãŒç›®ç«‹ã¤<strong>ã•ãã‚Šåº§</strong>ã€
          ç§‹ã¯å››è§’å½¢ã®<strong>ãƒšã‚¬ã‚¹ã‚¹åº§</strong>ã€å†¬ã¯ä¸‰ã¤æ˜ŸãŒãªã‚‰ã¶<strong>ã‚ªãƒªã‚ªãƒ³åº§</strong>ãªã©ã§ã™ã€‚
        </p>
      </div>
      <div class="info-item">
        <h4>â‘¢ åŒ—æ–—ä¸ƒæ˜Ÿã«ã¤ã„ã¦</h4>
        <p>
          <strong>åŒ—æ–—ä¸ƒæ˜Ÿ</strong>ã¯ã€å­£ç¯€ã«é–¢ä¿‚ãªãåŒ—ã®ç©ºã«è¦‹ãˆã‚‹æ˜Ÿåº§ã§ã™ã€‚ã²ã—ã‚ƒãã®å½¢ã‚’ã—ã¦ã„ã¦ã€ãã®å…ˆã‚’ãŸã©ã‚‹ã¨åŒ—æ¥µæ˜Ÿã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
          åŒ—æ–—ä¸ƒæ˜Ÿã¯ä¸€å¹´ä¸­è¦‹ãˆã‚‹ã®ã§ã€æ–¹è§’ã‚’çŸ¥ã‚‹æ‰‹ãŒã‹ã‚Šã¨ã—ã¦æ˜”ã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ãã¾ã—ãŸã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- â–¼ ã‚ã‹ã‚‹ç·¨ 3å• -->
  <section class="question-container">
    <div class="question-text" id="questionText"></div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="choices" id="choicesContainer"></div>
    <div class="explanation" id="explanationBox">
      <h4>è§£èª¬</h4>
      <p id="explanationText"></p>
    </div>
    <div class="navigation">
      <button class="nav-btn prev-btn" id="prevBtn">å‰ã®å•é¡Œã¸</button>
      <button class="nav-btn next-btn" id="nextBtn">æ¬¡ã®å•é¡Œã¸</button>
    </div>
    <div id="historyDisplay"></div>
  </section>
</main>

<script>
  /************ LearningTracker ************/
  class LearningTracker{
    constructor(lessonId){
      this.lessonId = lessonId;
      this.storageKey = "stepnavi_science_" + lessonId;
      this.currentSession = null;
      this.history = this.loadHistory();
    }
    loadHistory(){
      try{
        const raw = localStorage.getItem(this.storageKey);
        return raw ? JSON.parse(raw) : {sessions:[]};
      }catch(e){
        console.warn("Failed to load history:",e);
        return {sessions:[]};
      }
    }
    startSession(){
      this.currentSession = {
        startedAt:Date.now(),
        answered:0,
        correct:0,
        records:[]
      };
    }
    recordAnswer(questionIndex,isCorrect){
      if(!this.currentSession) this.startSession();
      const now = Date.now();
      this.currentSession.answered++;
      if(isCorrect) this.currentSession.correct++;
      this.currentSession.records.push({
        questionIndex,
        isCorrect,
        answeredAt:now
      });
      this.postToParent("question:answered",{
        lessonId:this.lessonId,
        questionIndex,
        isCorrect,
        timestamp:now
      });
    }
    completeLesson(totalQuestions){
      if(!this.currentSession) return;
      const now = Date.now();
      const durationMs = now - this.currentSession.startedAt;
      const summary = {
        ...this.currentSession,
        finishedAt:now,
        durationMs,
        totalQuestions
      };
      this.history.sessions.push(summary);
      try{
        localStorage.setItem(this.storageKey,JSON.stringify(this.history));
      }catch(e){
        console.warn("Failed to save history:",e);
      }
      this.postToParent("lesson:complete",{
        lessonId:this.lessonId,
        totalQuestions,
        answered:this.currentSession.answered,
        correct:this.currentSession.correct,
        durationMs
      });
      this.currentSession = null;
    }
    postToParent(type,payload){
      try{
        if(window.parent && window.parent !== window){
          window.parent.postMessage({type,payload},"*");
        }
      }catch(e){
        console.warn("postMessage failed:",e);
      }
    }
  }

  const LESSON_ID = "sci.earth.stars_constellations_sim";
  const tracker = new LearningTracker(LESSON_ID);

  /************ å­£ç¯€ã‚·ãƒŸãƒ¥åˆ¶å¾¡ ************/
  const earthOrbit = document.getElementById("earthOrbit");
  const nightArrow = document.getElementById("nightArrow");
  const nightArrowLabel = document.getElementById("nightArrowLabel");
  const seasonDesc = document.getElementById("seasonDesc");
  const simComment = document.getElementById("simComment");

  const seasonButtons = [
    document.getElementById("btnSpring"),
    document.getElementById("btnSummer"),
    document.getElementById("btnAutumn"),
    document.getElementById("btnWinter")
  ];

  let currentSeason = "spring";

  const seasonData = {
    spring:{
      orbitDeg:0,
      nightDeg:180, // orbitDeg(0) + 180
      desc:"æ˜¥ã®å¤œï¼šã—ã—åº§ãªã©ãŒã‚ˆãè¦‹ãˆã‚‹",
      comment:"<strong>æ˜¥åˆ†ã®ã“ã‚</strong>ã€å¤œã«ã¯ã—ã—åº§ãªã©æ˜¥ã®æ˜Ÿåº§ãŒã‚ˆãè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚åœ°çƒãŒå…¬è»¢ã™ã‚‹ã“ã¨ã§ã€å¤œã«å‘ã„ã¦ã„ã‚‹æ–¹å‘ãŒå¤‰ã‚ã‚Šã€æ˜¥ã«ã¯æ˜¥ã®æ˜Ÿåº§ãŒä¸»å½¹ã«ãªã‚Šã¾ã™ã€‚"
    },
    summer:{
      orbitDeg:90,
      nightDeg:270, // orbitDeg(90) + 180
      desc:"å¤ã®å¤œï¼šã•ãã‚Šåº§ãªã©ãŒã‚ˆãè¦‹ãˆã‚‹",
      comment:"<strong>å¤è‡³ã®ã“ã‚</strong>ã€å¤œã«ã¯ã•ãã‚Šåº§ãªã©å¤ã®æ˜Ÿåº§ãŒã‚ˆãè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚èµ¤ãå…‰ã‚‹ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹ã‚’ãµãã‚€ã•ãã‚Šåº§ã¯ã€å¤ã‚’ä»£è¡¨ã™ã‚‹æ˜Ÿåº§ã§ã™ã€‚"
    },
    autumn:{
      orbitDeg:180,
      nightDeg:0, // orbitDeg(180) + 180 = 360 = 0
      desc:"ç§‹ã®å¤œï¼šãƒšã‚¬ã‚¹ã‚¹åº§ãªã©ãŒã‚ˆãè¦‹ãˆã‚‹",
      comment:"<strong>ç§‹åˆ†ã®ã“ã‚</strong>ã€å¤œã«ã¯ãƒšã‚¬ã‚¹ã‚¹åº§ãªã©ç§‹ã®æ˜Ÿåº§ãŒé«˜ãã®ã¼ã£ã¦è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚å››è§’å½¢ã®ã€Œç§‹ã®å››è¾ºå½¢ã€ãŒç›®å°ã§ã™ã€‚"
    },
    winter:{
      orbitDeg:270,
      nightDeg:90, // orbitDeg(270) + 180 = 450 = 90
      desc:"å†¬ã®å¤œï¼šã‚ªãƒªã‚ªãƒ³åº§ãªã©ãŒã‚ˆãè¦‹ãˆã‚‹",
      comment:"<strong>å†¬è‡³ã®ã“ã‚</strong>ã€å¤œã«ã¯ã‚ªãƒªã‚ªãƒ³åº§ãªã©å†¬ã®æ˜Ÿåº§ãŒã‚ˆãè¦‹ãˆã¾ã™ã€‚ä¸‰ã¤æ˜ŸãŒä¸€ç›´ç·šã«ãªã‚‰ã¶ã‚ªãƒªã‚ªãƒ³åº§ã¯ã€å†¬ã®å¤œç©ºã§ã‚‚ã£ã¨ã‚‚ç›®ç«‹ã¤æ˜Ÿåº§ã®ä¸€ã¤ã§ã™ã€‚"
    }
  };

  function setSeason(season){
    currentSeason = season;
    seasonButtons.forEach(btn=>{
      btn.classList.toggle("active",btn.dataset.season===season);
    });

    const data = seasonData[season];
    // earth-orbit-posã¯åˆæœŸå›è»¢-20deg + orbitDegã§å›è»¢
    const totalRotation = data.orbitDeg - 20;
    earthOrbit.style.transform = "rotate(" + data.orbitDeg + "deg)";
    // çŸ¢å°ã¯earth-orbit-posã®ä¸­ã«ã‚ã‚‹ã®ã§ã€earth-orbit-posã®å›è»¢ã«åˆã‚ã›ã¦å¤ªé™½ã‹ã‚‰é ã–ã‹ã‚‹æ–¹å‘ï¼ˆå³æ–¹å‘ï¼‰ã‚’æŒ‡ã™
    // å›è»¢ã¯ä¸è¦ï¼ˆ0åº¦ã®ã¾ã¾ï¼‰
    nightArrow.style.transform = "translateY(-50%)";
    // ãƒ†ã‚­ã‚¹ãƒˆãƒ©ãƒ™ãƒ«ã¯å¸¸ã«æ­£ã—ã„å‘ãã«ä¿ã¤ãŸã‚ã€é€†æ–¹å‘ã«å›è»¢
    nightArrowLabel.style.transform = "rotate(" + (-totalRotation) + "deg)";

    seasonDesc.textContent = data.desc;
    simComment.innerHTML = data.comment;
  }

  seasonButtons.forEach(btn=>{
    btn.addEventListener("click",()=>setSeason(btn.dataset.season));
  });

  setSeason("spring");

  /************ ã‚ã‹ã‚‹ç·¨ï¼š3å• ************/
  const questions = [
    {
      id:"q1",
      text:"å­£ç¯€ã«ã‚ˆã£ã¦å¤œã«è¦‹ãˆã‚‹æ˜Ÿåº§ãŒå¤‰ã‚ã‚‹ä¸»ãªãŠã‚‚ãªç†ç”±ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
      choices:[
        "åœ°çƒãŒå¤ªé™½ã®ã¾ã‚ã‚Šã‚’å…¬è»¢ã—ã¦ã„ã‚‹ã‹ã‚‰",
        "åœ°çƒãŒ1æ—¥ã«1å›è‡ªè»¢ã—ã¦ã„ã‚‹ã‹ã‚‰",
        "æ˜ŸãŒè‡ªåˆ†ã§å‹•ãå›ã£ã¦ã„ã‚‹ã‹ã‚‰",
        "æœˆã®æº€ã¡æ¬ ã‘ãŒå¤‰ã‚ã‚‹ã‹ã‚‰"
      ],
      correct:0,
      explanation:"å­£ç¯€ã”ã¨ã«è¦‹ãˆã‚‹æ˜Ÿåº§ãŒå¤‰ã‚ã‚‹ã®ã¯ã€åœ°çƒãŒä¸€å¹´ã‹ã‘ã¦å¤ªé™½ã®ã¾ã‚ã‚Šã‚’<strong>å…¬è»¢</strong>ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚åœ°çƒã®ä½ç½®ãŒå¤‰ã‚ã‚‹ã¨ã€å¤œã«å¤ªé™½ã¨åå¯¾å´ã«è¦‹ãˆã‚‹æ–¹å‘ã‚‚å¤‰ã‚ã‚Šã€ãã®æ–¹å‘ã«ã‚ã‚‹æ˜Ÿåº§ãŒå­£ç¯€ã®æ˜Ÿåº§ã¨ã—ã¦è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚"
    },
    {
      id:"q2",
      text:"å¤ã®å¤œç©ºã‚’ä»£è¡¨ã™ã‚‹æ˜Ÿåº§ã¨ã—ã¦ã€ã‚‚ã£ã¨ã‚‚é©ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
      choices:[
        "ã•ãã‚Šåº§",
        "ã‚ªãƒªã‚ªãƒ³åº§",
        "ã—ã—åº§",
        "ãƒšã‚¬ã‚¹ã‚¹åº§"
      ],
      correct:0,
      explanation:"å¤ã®ä»£è¡¨çš„ãªæ˜Ÿåº§ã¯<strong>ã•ãã‚Šåº§</strong>ã§ã™ã€‚èµ¤ãæ˜ã‚‹ãå…‰ã‚‹ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹ã‚’ä¸­å¿ƒã«ã€æ›²ãŒã£ãŸå°¾ã®ã‚ˆã†ãªå½¢ãŒç‰¹å¾´ã§ã€å¤ã®å¤œç©ºã§ã¨ã¦ã‚‚ç›®ç«‹ã¤æ˜Ÿåº§ã§ã™ã€‚"
    },
    {
      id:"q3",
      text:"å†¬ã®å¤œç©ºã§ä¸‰ã¤æ˜ŸãŒãªã‚‰ã¶å½¢ãŒç›®ç«‹ã¤ã€ä»£è¡¨çš„ãªæ˜Ÿåº§ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
      choices:[
        "ã‚ªãƒªã‚ªãƒ³åº§",
        "ã•ãã‚Šåº§",
        "ã—ã—åº§",
        "ãŠãŠãã¾åº§"
      ],
      correct:0,
      explanation:"å†¬ã®ä»£è¡¨çš„ãªæ˜Ÿåº§ã¯<strong>ã‚ªãƒªã‚ªãƒ³åº§</strong>ã§ã™ã€‚çœŸã‚“ä¸­ã«ä¸‰ã¤æ˜ŸãŒä¸€ç›´ç·šã«ãªã‚‰ã¶ã€Œä¸‰ã¤æ˜Ÿã€ãŒã‚ã‚Šã€ãã®ä¸Šä¸‹ã«ã‚‚æ˜ã‚‹ã„æ˜ŸãŒãªã‚‰ã¶ã®ã§ã€ã¨ã¦ã‚‚è¦‹ã¤ã‘ã‚„ã™ã„æ˜Ÿåº§ã§ã™ã€‚"
    }
  ];

  let currentQuestionIndex = 0;
  let answeredFlags = new Array(questions.length).fill(false);

  const questionTextEl = document.getElementById("questionText");
  const choicesContainer = document.getElementById("choicesContainer");
  const explanationBox = document.getElementById("explanationBox");
  const explanationText = document.getElementById("explanationText");
  const progressFill = document.getElementById("progressFill");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  function renderQuestion(index){
    const q = questions[index];
    questionTextEl.textContent = "Q" + (index+1) + ". " + q.text;
    choicesContainer.innerHTML = "";
    explanationBox.classList.remove("show");
    explanationText.innerHTML = "";

    q.choices.forEach((choiceText,i)=>{
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.textContent = choiceText;
      btn.dataset.index = i;
      btn.addEventListener("click",()=>handleChoiceClick(index,i,btn));
      choicesContainer.appendChild(btn);
    });

    updateProgress();
    updateNavButtons();
  }

  function handleChoiceClick(qIndex,choiceIndex,btnEl){
    const q = questions[qIndex];
    if(answeredFlags[qIndex]) return;
    const allChoices = choicesContainer.querySelectorAll(".choice");
    allChoices.forEach(el=>el.disabled = true);

    const isCorrect = (choiceIndex === q.correct);
    answeredFlags[qIndex] = true;

    if(isCorrect){
      btnEl.classList.add("correct");
    }else{
      btnEl.classList.add("incorrect");
      const correctBtn = allChoices[q.correct];
      if(correctBtn) correctBtn.classList.add("correct");
    }

    explanationBox.classList.add("show");
    explanationText.innerHTML = q.explanation;

    tracker.recordAnswer(qIndex,isCorrect);
    
    updateProgress();
    updateNavButtons();
    
    if(answeredFlags.every(f=>f)){
      // ã™ã¹ã¦ã®å•é¡Œã«å›ç­”ã—ãŸå ´åˆã€å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
      nextBtn.disabled = true;
      prevBtn.disabled = true;
      nextBtn.style.opacity = "0.5";
      prevBtn.style.opacity = "0.5";
      
      setTimeout(() => {
        if(answeredFlags.every(f=>f)){
          showCompletionScreen();
        }
      }, 2000);
    }
  }

  function updateProgress(){
    const answeredCount = answeredFlags.filter(f=>f).length;
    const ratio = answeredCount / questions.length;
    progressFill.style.width = (ratio*100) + "%";
  }

  function updateNavButtons(){
    // ã™ã¹ã¦ã®å•é¡Œã«å›ç­”æ¸ˆã¿ã®å ´åˆã¯ã€å®Œäº†ç”»é¢è¡¨ç¤ºä¸­ãªã®ã§ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    if(answeredFlags.every(f=>f)){
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      return;
    }
    prevBtn.disabled = (currentQuestionIndex === 0);
    nextBtn.disabled = (currentQuestionIndex === questions.length-1);
  }

  prevBtn.addEventListener("click",()=>{
    if(currentQuestionIndex > 0){
      currentQuestionIndex--;
      renderQuestion(currentQuestionIndex);
    }
  });

  nextBtn.addEventListener("click",()=>{
    if(currentQuestionIndex < questions.length - 1){
      currentQuestionIndex++;
      renderQuestion(currentQuestionIndex);
    } else {
      // æœ€å¾Œã®å•é¡Œã§ã€Œæ¬¡ã®å•é¡Œã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
      if(answeredFlags.every(f=>f)){
        showCompletionScreen();
      }
    }
  });

  tracker.startSession();
  renderQuestion(currentQuestionIndex);

  function showCompletionScreen() {
    // å­¦ç¿’å±¥æ­´ã‚’ä¿å­˜
    tracker.saveSession();
    
    // ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†æ™‚ã«ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å‰Šé™¤
    clearCheckpoint();
    
    // UIã‚’å®Œäº†ç”»é¢ã«å¤‰æ›´
    questionTextEl.textContent = "å­¦ç¿’å®Œäº†ï¼ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸã€‚";
    choicesContainer.innerHTML = "";
    explanationBox.classList.remove("show");
    explanationText.innerHTML = "";
    
    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    nextBtn.style.display = "none";
    prevBtn.style.display = "none";
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
    progressFill.style.width = "100%";
    
    // ä»Šå›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœã‚’è¡¨ç¤º
    const historyDisplay = document.getElementById("historyDisplay");
    if (historyDisplay) {
      historyDisplay.innerHTML = showCurrentSessionResult();
      historyDisplay.style.display = "block";
      historyDisplay.style.visibility = "visible";
      historyDisplay.style.opacity = "1";
    }
    
    // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦ªãƒ•ãƒ¬ãƒ¼ãƒ ã«é€ä¿¡
    const totalQuestions = questions.length;
    const messageData = {
      type: 'lesson:complete',
      lessonId: LESSON_ID,
      detail: {
        correct: tracker.currentSession ? tracker.currentSession.correct : 0,
        total: totalQuestions,
        timeSec: tracker.currentSession ? Math.floor((Date.now() - tracker.currentSession.startedAt) / 1000) : 0
      }
    };
    
    try {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage(messageData, "*");
      } else {
        window.parent.postMessage(messageData, "*");
      }
    } catch (e) {
      console.warn("postMessage failed:", e);
    }
    
    // completeLessonã‚‚å‘¼ã³å‡ºã—ã¦å±¥æ­´ã«è¨˜éŒ²
    tracker.completeLesson(totalQuestions);
  }

  function clearCheckpoint() {
    try {
      const checkpointKey = `checkpoint:${LESSON_ID}`;
      localStorage.removeItem(checkpointKey);
      return true;
    } catch (error) {
      console.error('âŒ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      return false;
    }
  }

  function showCurrentSessionResult() {
    const session = tracker.currentSession;
    if (!session) return '';
    
    const totalQuestions = questions.length;
    const correct = session.correct || 0;
    const scorePercent = totalQuestions > 0 ? 
      Math.round((correct / totalQuestions) * 100) : 0;
    
    // æˆç¸¾ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    let resultMessage = '';
    if (scorePercent >= 90) {
      resultMessage = 'ğŸ‰ ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ï¼';
    } else if (scorePercent >= 70) {
      resultMessage = 'ğŸ‘ ã‚ˆãã§ãã¾ã—ãŸï¼';
    } else if (scorePercent >= 50) {
      resultMessage = 'ğŸ’ª ã‚‚ã†å°‘ã—é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
    } else {
      resultMessage = 'ğŸ“š å¾©ç¿’ã—ã¦å†æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼';
    }
    
    return `
      <div style="padding: 20px; background: linear-gradient(135deg, rgba(66,165,245,0.1), rgba(171,71,188,0.1)); border-radius: 12px; margin-top: 16px; border: 2px solid rgba(66,165,245,0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="margin-bottom: 16px; color: #1a237e; font-size: 18px; font-weight: bold;">ä»Šå›ã®çµæœ</h3>
        <p style="margin: 10px 0; color: #212121; font-size: 15px; line-height: 1.6;">
          <strong style="color: #1a237e;">æ­£è§£æ•°:</strong> <span style="font-weight: bold; color: #42a5f5;">${correct}</span> / <span style="color: #424242;">${totalQuestions}</span> å•
        </p>
        <p style="margin: 10px 0; color: #212121; font-size: 15px; line-height: 1.6;">
          <strong style="color: #1a237e;">æ­£ç­”ç‡:</strong> <span style="font-weight: bold; color: #ab47bc; font-size: 16px;">${scorePercent}%</span>
        </p>
        <p style="margin: 16px 0 0 0; color: #1a237e; font-size: 16px; font-weight: bold; padding-top: 12px; border-top: 2px solid rgba(66,165,245,0.3);">
          ${resultMessage}
        </p>
      </div>
    `;
  }

  /************ ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ ************/
  function goHome() {
    try {
      if (window.parent && window.parent !== window) {
        // app.jsã§å‡¦ç†ã•ã‚Œã¦ã„ã‚‹lesson:goBackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        window.parent.postMessage({ type: "lesson:goBack" }, "*");
        console.log("ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ");
      } else {
        // å˜ä½“å®Ÿè¡Œæ™‚ã¯ç›´æ¥ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
        console.log("goHome called (standalone)");
        window.location.href = "/index.html";
      }
    } catch (e) {
      console.warn("goHome failed:", e);
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç›´æ¥ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
      try {
        window.location.href = "/index.html";
      } catch (e2) {
        console.error("ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚å¤±æ•—:", e2);
      }
    }
  }
  window.goHome = goHome;
</script>
</body>
</html>
